<div class="dh-main-layout">
<style>
    /* Layout */
    .dh-main-layout { display: flex; gap: 15px; height: 100%; }
    .dh-left-col { flex: 1; display: flex; flex-direction: column; gap: 12px; }
    .dh-right-col { width: 150px; display: flex; flex-direction: column; gap: 5px; border-left: 1px solid #444; padding-left: 10px; overflow-y: auto; max-height: 400px; }

    /* Existing Styles Adapted */
    .dh-rr-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .dh-rr-label { font-weight: bold; color: #C9A060; flex: 0 0 80px; text-align: right; padding-right: 5px; margin-bottom: 0; }
    .dh-rr-input { flex: 1; text-align: center; background: rgba(255,255,255,0.9); border: 1px solid #7a6e5d; padding: 5px; border-radius: 4px; color: #000000 !important; font-weight: bold; }
    
    .dh-trait-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-top: 5px; }
    .dh-trait-grid button.full-width { grid-column: 1 / -1; }
    
    .dh-trait-btn { 
        background: #191919; 
        color: #ffffff; 
        border: 1px solid #666; 
        padding: 6px; 
        cursor: pointer; 
        border-radius: 4px; 
        font-size: 0.9em; 
        text-transform: uppercase; 
        transition: all 0.2s; 
    }
    .dh-trait-btn:hover { border-color: #C9A060; color: #C9A060; }
    .dh-trait-btn.active { background: #C9A060; color: #191919; border-color: #C9A060; font-weight: bold; box-shadow: 0 0 8px rgba(201, 160, 96, 0.4); }
    
    .dh-special-btn { font-weight: bold; border-width: 2px; }
    .dh-special-btn[data-special="hope"] { border-color: #FFD700; color: #FFD700; }
    .dh-special-btn[data-special="hope"].active, .dh-special-btn[data-special="hope"]:hover { background: #FFD700; color: #000; box-shadow: 0 0 8px #FFD700; }
    
    .dh-special-btn[data-special="fear"] { border-color: #800080; color: #b54ec4; }
    .dh-special-btn[data-special="fear"].active, .dh-special-btn[data-special="fear"]:hover { background: #800080; color: #fff; box-shadow: 0 0 8px #800080; }

    .dh-cb-row { display: flex; align-items: center; justify-content: space-around; background: rgba(0,0,0,0.2); padding: 8px 10px; border-radius: 4px; }
    .dh-cb-label { display: flex; align-items: center; gap: 8px; color: #e0e0e0; cursor: pointer; font-size: 0.95em; margin-bottom: 0; }
    .dh-cb-label input { accent-color: #C9A060; transform: scale(1.2); margin: 0; }
    .dh-sq-btn { width: 32px; height: 30px; padding: 0; border: 1px solid #555; background: #191919; color: #C9A060; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background 0.2s; font-size: 0.9em; }
    .dh-sq-btn:hover { background: #C9A060; color: #191919; }
    .dh-dc-wrapper { display: flex; align-items: center; gap: 4px; flex: 1; }
    
    /* User Buttons (Right Column) */
    .dh-user-btn {
        background: #2b2b2b;
        color: #e0e0e0;
        border: 1px solid #555;
        padding: 8px;
        text-align: left;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s;
        font-weight: bold;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
    }
    .dh-user-btn:hover {
        background: #C9A060;
        color: #191919 !important;
        border-color: #C9A060;
    }

    .dh-btn-cancel { 
        background: transparent; 
        color: #e0e0e0; 
        border: 1px solid #777; 
        padding: 10px; 
        width: 100%; 
        text-transform: uppercase; 
        cursor: pointer; 
        border-radius: 4px; 
        transition: all 0.2s;
        margin-top: auto;
    }
    .dh-btn-cancel:hover { color: #fff; border-color: #fff; background: rgba(255,255,255,0.1); }
</style>

    <!-- LEFT COLUMN -->
    <div class="dh-left-col">
        <div class="dh-rr-row">
            <label class="dh-rr-label">Difficulty</label>
            <div class="dh-dc-wrapper">
                <button type="button" class="dh-sq-btn" data-action="mod-dc" data-value="-5">-5</button>
                <button type="button" class="dh-sq-btn" data-action="mod-dc" data-value="-2">-2</button>
                <button type="button" class="dh-sq-btn" data-action="mod-dc" data-value="-1">-1</button>
                <input type="number" name="difficulty" value="{{difficulty}}" class="dh-rr-input" placeholder="DC" style="width: 70px; flex: 0 0 70px;">
                <button type="button" class="dh-sq-btn" data-action="mod-dc" data-value="1">+1</button>
                <button type="button" class="dh-sq-btn" data-action="mod-dc" data-value="2">+2</button>
                <button type="button" class="dh-sq-btn" data-action="mod-dc" data-value="5">+5</button>
                <button type="button" class="dh-sq-btn" data-action="clear-dc" title="Clear Difficulty" style="margin-left: 5px; color: #ff6b6b; border-color: #ff6b6b;">
                    <i class="fas fa-eraser"></i>
                </button>
            </div>
        </div>
        
        <div>
            <label class="dh-rr-label" style="text-align: left; display:block;">Trait</label>
            <input type="hidden" name="trait" value="">
            <input type="hidden" name="specialRoll" value="">
            
            <div class="dh-trait-grid">
                <button type="button" class="dh-trait-btn full-width active" data-trait="">None</button>
                <div style="grid-column: 1 / -1; display: flex; gap: 10px; margin-bottom: 2px;">
                        <button type="button" class="dh-trait-btn dh-special-btn" data-special="hope" style="flex:1;">HOPE</button>
                        <button type="button" class="dh-trait-btn dh-special-btn" data-special="fear" style="flex:1;">FEAR</button>
                </div>
                <button type="button" class="dh-trait-btn" data-trait="agility">Agility</button>
                <button type="button" class="dh-trait-btn" data-trait="strength">Strength</button>
                <button type="button" class="dh-trait-btn" data-trait="finesse">Finesse</button>
                <button type="button" class="dh-trait-btn" data-trait="instinct">Instinct</button>
                <button type="button" class="dh-trait-btn" data-trait="presence">Presence</button>
                <button type="button" class="dh-trait-btn" data-trait="knowledge">Knowledge</button>
            </div>
        </div>

        <div class="dh-cb-row">
            <label class="dh-cb-label">Advantage <input type="checkbox" name="advantage"></label>
            <label class="dh-cb-label">Disadvantage <input type="checkbox" name="disadvantage"></label>
            <label class="dh-cb-label">Reaction <input type="checkbox" name="reaction"></label>
        </div>
        <div class="dh-cb-row">
            <label class="dh-cb-label">Grant Resources <input type="checkbox" name="grantResources" checked></label>
            <label class="dh-cb-label" style="color: #ffaa44;">Cinematic Mode <input type="checkbox" name="cinematicMode" {{#if cinematicMode}}checked{{/if}}></label>
        </div>
        
        <div class="dh-rr-row">
            <label class="dh-rr-label">Label</label>
            <input type="text" name="label" class="dh-rr-input" placeholder="Optional description...">
        </div>

        <button type="button" class="dh-btn-cancel" data-action="cancel">Cancel</button>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="dh-right-col">
        <div style="font-weight: bold; color: #C9A060; text-align: center; margin-bottom: 5px; text-transform: uppercase; font-size: 0.9em;">Send To</div>
        <button type="button" class="dh-user-btn" data-action="roll" data-target="">All Players</button>
        {{#each connectedUsers}}
        <button type="button" class="dh-user-btn" data-action="roll" data-target="{{this.id}}" style="color:{{this.color}}">{{this.name}}</button>
        {{/each}}
    </div>
</div>